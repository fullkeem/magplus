# TASK-002: 데이터베이스 스키마 설계 및 마이그레이션

## 세부 태스크 목록

### 2.1 Articles 테이블 설계

- 아티클 기본 정보 필드 정의 (id, title, content, excerpt)
- 이미지 URL 배열 필드 (images)
- 카테고리 외래키 설정 (category_id)
- 지역 정보 필드 (region)
- 조회수, 좋아요 수 필드 (views, likes)
- 발행 상태 필드 (status: draft/published)
- 생성/수정 타임스탬프 (created_at, updated_at)
- SEO 관련 필드 (slug, meta_title, meta_description)

### 2.2 Categories 테이블 설계

- 카테고리 기본 정보 (id, name, slug)
- 카테고리 설명 및 이미지 (description, image_url)
- 정렬 순서 필드 (sort_order)
- 활성화 상태 필드 (is_active)
- 생성/수정 타임스탬프 (created_at, updated_at)

### 2.3 Subscriptions 테이블 설계

- **이메일 기반 구독 시스템** (인증 없음)
- 구독자 이메일 정보 (email - PRIMARY KEY)
- 구독 상태 관리 (is_active)
- 구독 카테고리 설정 (subscribed_categories - JSON 배열)
- 구독/해지 타임스탬프 (subscribed_at, unsubscribed_at)
- 이메일 인증 토큰 (verification_token)
- 인증 상태 (is_verified)

### 2.4 Shares 테이블 설계

- 공유된 아티클 정보 (article_id)
- 공유 플랫폼 구분 (platform: facebook/twitter/kakao/etc)
- 공유 통계 집계 (share_count)
- 공유 타임스탬프 (shared_at)
- 공유자 식별 (anonymous_id - 선택적)

### 2.5 마이그레이션 파일 작성

- 001_create_categories.sql
- 002_create_articles.sql
- 003_create_subscriptions.sql (이메일 기반)
- 004_create_shares.sql

### 2.6 RLS 정책 설정

- **공개 읽기 정책** (인증 없이 모든 콘텐츠 접근 가능)
- Articles: 모든 사용자 읽기 권한, API Key 기반 쓰기 권한
- Categories: 모든 사용자 읽기 권한, API Key 기반 쓰기 권한
- Subscriptions: 이메일 소유자만 본인 정보 접근
- Shares: 모든 사용자 읽기 권한, 공유 시 쓰기 권한

### 2.7 초기 데이터 시드

- 기본 카테고리 데이터 (카페, 레스토랑, 팝업스토어, 문화공간, 쇼핑몰, 전시회)
- 샘플 아티클 데이터 (각 카테고리별 2-3개)
- 지역 데이터 (서울, 부산, 대구, 인천, 광주, 대전, 울산, 세종, 경기, 강원, 충북, 충남, 전북, 전남, 경북, 경남, 제주)

## 완료 조건

- [x] 모든 테이블 생성 완료
- [x] 외래키 관계 설정 확인
- [x] **공개 읽기 RLS 정책** 적용 확인
- [x] **이메일 기반 구독 시스템** 테스트
- [x] 초기 데이터 삽입 성공
- [x] 마이그레이션 롤백 테스트
      description:
      globs:
      alwaysApply: false

---
